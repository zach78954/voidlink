mirror_to_github:
  stage: release
  image:
    name: alpine/git:latest
    entrypoint: [""]
  script:
    - |
      if [ -z "$GITHUB_REPO" ] || [ -z "$GITHUB_USER" ] || [ -z "$GITHUB_TOKEN" ]; then
        echo "GitHub credentials (GITHUB_REPO, GITHUB_USER, GITHUB_TOKEN) not set. Skipping mirror."
        exit 0
      fi
    - echo "Mirroring to GitHub..."
    - git remote add github https://$GITHUB_USER:$GITHUB_TOKEN@$GITHUB_REPO
    - git fetch --unshallow origin || git fetch origin # Ensure we have history
    - git push --force github HEAD:$CI_COMMIT_REF_NAME
  allow_failure: true
